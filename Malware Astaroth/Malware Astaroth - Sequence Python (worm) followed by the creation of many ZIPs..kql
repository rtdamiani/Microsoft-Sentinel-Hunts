let lookback = 30d;
let py = DeviceProcessEvents
| where TimeGenerated > ago(lookback)
| where FileName in~ ("python.exe","pythonw.exe")
| project DeviceId, DeviceName, PyTime=TimeGenerated, PyCmd=ProcessCommandLine, PyProcId=ProcessId;
let zips = DeviceFileEvents
| where TimeGenerated > ago(lookback)
| where ActionType in~ ("FileCreated","FileModified","FileRenamed")
| where FileName endswith ".zip"
| project DeviceId, DeviceName, ZipTime=TimeGenerated, ZipName=FileName, ZipPath=FolderPath, ZipProc=InitiatingProcessFileName, ZipCmd=InitiatingProcessCommandLine;
py
| join kind=inner zips on DeviceId
| where ZipTime between (PyTime .. PyTime + 20m)
| summarize ZipCount=count(), SampleZips=make_set(ZipName, 10), SamplePaths=make_set(ZipPath, 5) by DeviceName, bin(PyTime, 30m), PyCmd
| where ZipCount >= 20
| order by PyTime desc